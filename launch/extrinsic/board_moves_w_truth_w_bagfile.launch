<?xml version="1.0" encoding="utf-8"?>
<launch>

    <arg name="camera_info" default="file://$(find calibrate_mocap_and_camera)/launch/rgb_PS1080_PrimeSense.yaml"/>
    <arg name="rgb_optical_frame" default="rgb_optical_frame" />

    <arg name="file_A" default="extrinsic_calib_2015-12-16-13-53-19.bag" />
    <arg name="file_B" default="extrinsic_calib_2015-12-16-14-33-58.bag" />
    <arg name="file_C" default="extrinsic_calib_2015-12-15-14-35-08.bag" />
    <arg name="file_D" default="" />
    <arg name="file_E" default="" />    
    <arg name="file_1" default="$(arg file_B)" />
    
    <!-- parameters for real-time rviz visualization -->
    <arg name="run_rviz" default="false"/>
    <arg name="path" default="$(find calibrate_mocap_and_camera)" />
    <arg name="rviz_config_file" default="calibrate_mocap_and_camera_bagfile.rviz" />    
    
    <param name="use_sim_time" value="true" />
    <node pkg="rosbag" type="play" name="player" output="screen" 
          args="-r 1 --clock $(arg path)/../../../$(arg file_1)"/> 
  
    <node pkg="rviz" type="rviz" name="rviz" output="screen" 
          args="-d $(arg path)/rviz/$(arg rviz_config_file)"/>

    <arg name="result_display" default="true"/>
    <arg name="result_autosize" default="true"/>
    <arg name="result_draw_markers" default="true" />
    <arg name="result_draw_markers_cube" default="true" />
    <arg name="result_draw_markers_axis" default="true" />

    <arg name="uid" default=""/>
    <arg name="video_namespace" default="camera/rgb"/>
    <arg name="video_image_topic" default="image_raw"/>
    <arg name="video_info_topic" default="camera_info"/>
    <arg name="video_rectified" default="false" />

    <arg name="board_config" default="$(find calibrate_mocap_and_camera)/data/single/pose_calib_00.yml" />
    <arg name="board_frame_id" default="ar_calib_frame" />
    <arg name="marker_size" default="0.035" />
    <arg name="publish_tf" default="true" />

    <!--
    <group if="$(arg camera_enable)">
        <node ns="$(arg video_namespace)" pkg="image_proc" type="image_proc" name="image_proc$(arg uid)" />
        <node ns="$(arg video_namespace)" pkg="uvc_camera" type="uvc_camera_node" name="uvc_camera$(arg uid)" output="screen">
            <param name="width" type="int" value="$(arg camera_width)" />
            <param name="height" type="int" value="$(arg camera_height)" />
            <param name="fps" type="int" value="$(arg camera_fps)" />
            <param name="frame_id" type="string" value="/$(arg camera_frame_id)" />
            <param name="device" type="string" value="$(arg camera_device)" />
            <param name="camera_info_url" type="string" value="$(arg camera_info)" />
        </node>
    </group>
    -->
    <!--
    <node ns="/" pkg="ar_sys" type="single_board" name="ar_single_board$(arg uid)" output="screen">
        <remap from="/camera_info" to="$(arg video_namespace)/$(arg video_info_topic)" />
        <remap from="/image" to="$(arg video_namespace)/$(arg video_image_topic)" />

        <param name="image_is_rectified" type="bool" value="$(arg video_rectified)"/>
        <param name="board_config" type="string" value="$(arg board_config)"/>
        <param name="board_frame" type="string" value="/$(arg board_frame_id)" />
        <param name="marker_size" type="double" value="$(arg marker_size)"/>
        <param name="draw_markers" type="bool" value="$(arg result_draw_markers)" />
        <param name="draw_markers_cube" type="bool" value="$(arg result_draw_markers_cube)" />
        <param name="draw_markers_axis" type="bool" value="$(arg result_draw_markers_axis)" />
        <param name="publish_tf" value="$(arg publish_tf)" />
    </node>
    <node ns="/" pkg="topic_tools" type="relay" name="ar_single_board_relay$(arg uid)" args="/ar_single_board$(arg uid)/transform /arsys_single_board/transform" />

    <group if="$(arg result_display)">
        <node ns="/" pkg="image_view" type="image_view" name="image_view$(arg uid)" output="screen">
            <remap from="image" to="/ar_single_board$(arg uid)/result" />

            <param name="autosize" type="bool" value="$(arg result_autosize)" />
        </node>
    </group>
    -->
        
    <!-- parameters for ground truth experiments -->
    <!-- specify the vrpn server IP for transform ground truth -->
    <arg name="use_optitrack" default="true" />
    <arg name="vrpn_server_ip" default="192.168.0.20" />    
    <arg name="vrpn_tf_calib_marker_topic" default="/tf_calib/pose" />  
    <arg name="vrpn_tf_cam_marker_topic" default="/tf_cam/pose" />   
    
    <node name="calibrate_mocap_and_camera" pkg="calibrate_mocap_and_camera"
        type="calibrate_mocap_and_camera"
        output="screen">
        
        <param name="tf_cam_topic" value="/tf_cam/pose"/>
        <param name="tf_calib_topic" value="/tf_calib/pose"/>
        <param name="optical_parent" value = "optitrack"/>
        <param name="optical_frame" value = "$(arg rgb_optical_frame)"/>
    </node>
    <!--
  <node name="reefbot_base" pkg="tf" 
          type="static_transform_publisher"  
          args="0.0 -0.01 0.01  -0.5 0.5 -0.5 -0.5 $(arg rgbd_frame) reefbot_base 100" />
    -->
    <new name="tf_calib_to_ar_calib" pkg="tf"
        type="static_transform_publisher"
        args="0.00085 -0.017555 -0.000385 0 0 0 1 $(arg vrpn_tf_calib_marker_topic) ar_calib_frame 1000" />

    <new name="ar_calib_to_optical_ar_calib" pkg="tf"
        type="static_transform_publisher"
        args="0.0 0.0 0.0 0.5 -0.5 0.5 -0.5 ar_calib_frame ar_optical_frame 1000" />    
</launch>
