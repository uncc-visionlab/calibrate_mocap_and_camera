<launch>
    <arg name="driver_usb_cam" value="false"/>
    <arg name="driver_cv_camera" value="true"/>

    <node name="usb_cam" pkg="usb_cam" type="usb_cam_node" output="screen" 
          if="$(arg driver_usb_cam)">
        <param name="video_device" value="/dev/video0" />
        <param name="image_width" value="640" />
        <param name="image_height" value="480" />
        <param name="pixel_format" value="yuyv" />
        <param name="camera_frame_id" value="usb_cam" />
        <param name="io_method" value="mmap"/>
    </node>     

    <node name="cv_camera_node" pkg="cv_camera" type="cv_camera_node" 
          output="screen" if="$(arg driver_cv_camera)"/>    

    <arg name="markerId"        default="582"/>
    <arg name="markerSize"      default="0.10"/>    <!-- in m -->
    <arg name="eye"             default="left"/>
    <arg name="marker_frame"    default="aruco_marker_frame"/>
    <arg name="ref_frame"       default=""/>  <!-- leave empty and the pose will be published wrt param parent_name -->

    <arg name="result_display" default="true"/>
    <arg name="result_autosize" default="false"/>
    <arg name="result_draw_markers" default="true" />
    <arg name="result_draw_markers_cube" default="true" />
    <arg name="result_draw_markers_axis" default="true" />
    <arg name="uid" default=""/>

    <node pkg="aruco_ros" type="single" name="aruco_single">
        <remap from="/camera_info" to="/cv_camera_node/camera_info" if="$(arg driver_cv_camera)"/>
        <remap from="/image" to="/cv_camera_node/image_raw" if="$(arg driver_cv_camera)"/>
        <remap from="/camera_info" to="/usb_cam/camera_info" if="$(arg driver_usb_cam)"/>
        <remap from="/image" to="/usb_cam/image_raw" if="$(arg driver_usb_cam)"/>
        
        <param name="image_is_rectified" value="false"/>
        <param name="marker_size"        value="$(arg markerSize)"/>
        <param name="marker_id"          value="$(arg markerId)"/>
        <param name="reference_frame"    value="$(arg ref_frame)"/>   <!-- frame in which the marker pose will be refered -->
        <param name="camera_frame"       value="stereo_gazebo_$(arg eye)_camera_optical_frame"/>
        <param name="marker_frame"       value="$(arg marker_frame)" />
        <param name="draw_markers" type="bool" value="$(arg result_draw_markers)" />
        <param name="draw_markers_cube" type="bool" value="$(arg result_draw_markers_cube)" />
        <param name="draw_markers_axis" type="bool" value="$(arg result_draw_markers_axis)" />
    </node> 
    
    <group if="$(arg result_display)">
        <node ns="/" pkg="image_view" type="image_view" name="image_view$(arg uid)" output="screen">
            <remap from="image" to="/aruco_single$(arg uid)/result" />
          <!--  <remap from="image" to="/cv_camera_node/image_raw" if="$(arg driver_cv_camera)"/>
            <remap from="image" to="/usb_cam/image_raw" if="$(arg driver_usb_cam)"/> -->
            <param name="autosize" type="bool" value="$(arg result_autosize)" />
        </node>
    </group>
</launch>

